(function(b,e){var f={addTour:function(){e.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGetTourHtml"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(h,i,g){if(h.status){f.Modal.showModal('<i class="fa fa-plus-square" aria-hidden="true"></i> New tour',h.data.html);f.Waiting.success()}else{f.Log.appendArray(h.messages);f.Waiting.stay()}}).fail(function(){f.Waiting.stay()}).always(function(){f.Waiting.stay()})},editTour:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxGetTourHtml"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status){f.Modal.showModal('<i class="fa fa-plus-square" aria-hidden="true"></i> Edit tour',j.data.html);f.Waiting.success()}else{f.Log.appendArray(j.messages);f.Waiting.stay()}}).fail(function(){f.Waiting.stay()}).always(function(){f.Waiting.stay()})},editTourHotspot:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxGetHotspotEditorHtml"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status){f.Modal.showModal('<i class="fa fa-plus-square" aria-hidden="true"></i> Add hotspot',j.data.html);f.Waiting.success()}else{f.Log.appendArray(j.messages);f.Waiting.stay()}}).fail(function(){f.Waiting.stay()}).always(function(){f.Waiting.stay()})},embedTour:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxGetTourEmbedHtml"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status){f.Modal.showModalWithText('<i class="fa fa-plus-square" aria-hidden="true"></i> Embed code',j.data.html);f.Waiting.success()}else{f.Log.appendArray(j.messages);f.Waiting.stay()}}).fail(function(){f.Waiting.stay()}).always(function(){f.Waiting.stay()})},deleteTour:function(g){var h=e(g).attr("data-tour-id");e.ajax({url:"index.php",type:"POST",data:{id:h,view:"tour",task:"ajaxDeleteTour"},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(j,k,i){if(j.status==true){e("table#vTours tr#vtour-"+h).remove();f.Waiting.success()}}).fail(function(){f.Waiting.stay()}).always(function(){f.Waiting.stay()})},hooks:function(){e("body").on("click","#reset-search",function(g){g.preventDefault();e('input[name="keyword"]').val("");e('form[name="search-form"]').submit()});e("body").on("click",".addNew",function(){f.addTour()});e("body").on("click",".editTour",function(){f.editTour(this)});e("body").on("click",".editTourHotspot",function(){f.editTourHotspot(this)});e("body").on("click",".embedCode",function(){f.embedTour(this)});e("body").on("click","button.removeTour",function(g){g.preventDefault();if(confirm("Confirm delete a tour")){f.deleteTour(this)}});e("body").on("click","button.btn-log-close",function(g){g.preventDefault();f.Log.reset();e("body").removeClass("loading")});c.hooks()}};var c={generateAlias:function(){var g=e("#form-tour input#name").val();g=g.toLowerCase().replace(/\s+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"");e("#form-tour input#alias").val(g)},hooks:function(){e("body").on("blur","#form-tour input#name",function(){c.generateAlias()});e("body").on("blur","#form-tour input#alias",function(){var h=e('#form-tour input[name="id"]');var g=e("#form-tour input#alias").val();if(h.length==1){h=e(h).val()}e.ajax({url:"index.php",type:"POST",data:{id:h,alias:g,view:"tour",task:"ajaxValidateAlias"},async:true,cache:false}).done(function(j,k,i){if(j.status==true){e("input#alias").removeClass("error");e("#saveTour").removeAttr("disabled")}else{alert(j.data.text);e("#saveTour").attr("disabled","disabled")}})});e("body").on("submit","form#form-tour",function(g){g.preventDefault();var h=new FormData(this);e.ajax({url:"index.php",type:"POST",data:h,async:true,cache:false,processData:false,contentType:false,beforeSend:function(){e("body").addClass("loading");e("#overlay-waiting .btn-log-close").addClass("hide")}}).done(function(j,k,i){if(j.status){location.reload()}else{f.Log.appendArray(j.messages)}}).fail(function(){e("#overlay-waiting .btn-log-close").removeClass("hide")}).always(function(){e("#overlay-waiting .btn-log-close").removeClass("hide")})});d.hooks();a.hooks()}};var d={addNew:function(){var g=e(".hidden .scene").parent().html();e("#scenes .alert").remove();e("#scenes").append(g);e.validate({modules:"file"})},makeDefault:function(g){e("#form-tour input[type='checkbox'][name='sceneDefault']:checked").prop("checked",false);e(g).prop("checked",true)},remove:function(g){e(g).parent().parent().parent().parent().remove()},hooks:function(){e("body").on("click","button#addScene",function(){d.addNew()});e("body").on("click","#form-tour button.removeScene",function(h){var g=h.target||h.currentTarget;d.remove(g)});e("body").on("change","#form-tour input[type='checkbox'][name='sceneDefault']",function(h){var g=h.target||h.currentTarget;d.makeDefault(g)})}};var a={saveHotspot:function(g){var i=e(g).data("tour-id");var h=document.getElementById("editTourHotspots").contentWindow;if(!h.isReady()){alert("Please finish to add hotspot before saving or click cancel");return false}e.ajax({url:"index.php",type:"POST",data:{view:"hotspot",task:"ajaxSaveHotspot",id:i,hotspotList:JSON.stringify(h.superHotspot.getData().hotspotList),defaultViewList:JSON.stringify(h.defaultViewList)},async:true,cache:false,beforeSend:function(){f.Waiting.waiting()}}).done(function(k,l,j){f.Log.appendArray(k.messages);f.Waiting.stay()}).fail(function(){e("#overlay-waiting .btn-log-close").removeClass("hide")}).always(function(){e("#overlay-waiting .btn-log-close").removeClass("hide")})},hooks:function(){e("body").on("click","button#saveHotspots",function(g){g.preventDefault();f.Tour.Hotspot.saveHotspot(this)})}};f.Tour=c;f.Tour.Scene=d;f.Tour.Hotspot=a;b.vrAdmin=f;e(document).ready(function(){b.vrAdmin.hooks()})})(window,jQuery);