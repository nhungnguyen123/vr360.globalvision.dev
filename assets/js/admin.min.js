(function(a,b){var c={};c.Controls={addNew:function(){b.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGetTourHtml"},async:true,cache:false}).done(function(e,f,d){if(e.status){b("#vrTour .modal-body .container-fluid").html(e.data.html);b("#vrTour").modal("show")}});b("#vrTour").modal("show")},hooks:function(){b(".addNew").on("click",function(){c.Controls.addNew()})}};c.Tours={showEmbed:function(d){b(d).find(".embedCode").on("click",function(e){b("#vrModal .modal-body").text(template);b("#vrModal").modal("show")})},showEdit:function(d){var e=b(d).data();b(d).find(".editTour").on("click",function(f){b.ajax({url:"index.php",type:"POST",data:{id:e.tour.id,view:"tour",task:"ajaxGetTourHtml"},async:true,cache:false}).done(function(h,i,g){if(h.status){b("#vrTour .modal-body .container-fluid").html(h.data.html);b("#vrTour").modal("show")}})})},showEditHotspot:function(d){var e=b(d).data();b(d).find(".editTourHotspot").on("click",function(f){b.ajax({url:"index.php",type:"POST",data:{id:e.tour.id,view:"tour",task:"ajaxGetHotspotEditorHtml"},async:true,cache:false}).done(function(h,i,g){if(h.status){b("#vrTour .modal-body .container-fluid").html(h.data.html);b("#vrTour").modal("show")}})})},showPreview:function(d){var e=b(d).data();b(d).find(".previewTour").on("click",function(f){var g=window.open("./"+e.tour.alias,"_blank")})},hooks:function(){b("#vTours tbody tr").each(function(){c.Tours.showEmbed(this);c.Tours.showEdit(this);c.Tours.showEditHotspot(this);c.Tours.showPreview(this)})}};c.Tour={validate:function(){c.Log.append("File validating");b("#tour-panos input[type=file]").each(function(){var f=this.files[0];if(f.type!="image/jpeg"&&f.type!="image/png"){return"File format is not valid"}var d=26214400;var e=5242880;if(f.size>=d||f.size<=e){return"File size is not valid"}});return""},disableForm:function(){b("form input").prop("disabled",true);b("form button").prop("disabled",true);b("body").addClass("loading")},enableForm:function(){b("form input").prop("disabled",false);b("form button").prop("disabled",false);b("body").removeClass("loading")},throwFail:function(e,f,d){alert(f);c.Tour.enableForm()},removeTour:function(d){b.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxRemoveTour",id:d.id}}).done(function(f,g,e){if(f.status==true){b("#vtour-"+f.data.id).fadeOut("slow")}else{alert("Something wrong")}})},hooks:function(){b("body").on("submit","#createTour",function(d){c.Log.reset();validate=c.Tour.validate();var e=new FormData(this);b.ajax({url:"index.php",type:"POST",data:e,async:true,cache:false,contentType:false,processData:false,beforeSend:function(f){c.Tour.disableForm()}}).done(function(h,i,g){if(h.status===true){c.Log.appendArray(h.messages);var f=h.data.tour;f.view="tour";f.task="ajaxCreateTour";f.step="createTour";if(typeof h.data.id!=="undefined"){f.id=h.data.id}b.ajax({url:"index.php",type:"POST",data:f,async:true,cache:false}).done(function(k,l,j){if(k.status===true){c.Log.appendArray(k.messages);c.Log.append("Generating vr360");b.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxGenerateTour",id:k.data.id},async:true,cache:false}).done(function(n,o,m){if(n.status===true){c.Log.appendArray(n.messages);c.Log.append("Page reloading ...");setTimeout(location.reload(),2000)}else{c.Log.appendArray(n.messages)}}).always(function(n,o,m){if(o=="timeout"){c.Tour.throwFail(n,o,m)}c.Tour.enableForm()}).fail(function(n,o,m){c.Tour.throwFail(n,o,m)})}else{c.Log.appendArray(k.messages);c.Tour.enableForm()}}).fail(function(k,l,j){c.Tour.throwFail(k,l,j)})}else{c.Log.appendArray(h.messages);c.Tour.enableForm()}}).fail(function(g,h,f){c.Tour.throwFail(g,h,f)});d.preventDefault()});b("body").on("click",".removeTour",function(d){if(confirm("Confirm delete a tour")){var e=b(this).parent().parent().data();c.Tour.removeTour(e.tour);d.preventDefault()}})}};c.Panos={};c.Pano={hooks:function(){b("body").on("click","#addPano",function(){var d=b(".hidden .pano").parent().html();b("#tour-panos").append(d)});b("body").on("click",".removePano",function(d){b(this).parent().parent().remove()})}};a.vrAdmin=c;b(document).ready(function(){c.Controls.hooks();c.Tours.hooks();c.Tour.hooks();c.Pano.hooks()})})(window,jQuery);function getHotspotData(){var a=document.getElementById("editTourHotspots").contentWindow;if(!a.rdy4save()){alert("Please finish to add hotspot before saving or click cancel");return false}else{return a.superHotspot.getData().hotspotList}}function submitHotspotData(a){if(!getHotspotData){return 0}$.ajax({url:"index.php",type:"POST",data:{view:"tour",task:"ajaxSaveHotspot",id:a,hotspotList:JSON.stringify(getHotspotData())},async:true,cache:false}).done(function(c,d,b){if(c.status===true){vrAdmin.Log.appendArray(c.messages);vrAdmin.Log.append("Page reloading ...")}else{vrAdmin.Log.appendArray(c.messages)}})};